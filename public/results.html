<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trip Results</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      padding-top: 80px;
      background: #f5f7fa;
      font-family: Arial, sans-serif;
    }

    header.header-bar {
      background-color: #0077cc;
      color: white;
      font-size: 24px;
      font-weight: bold;
      padding: 15px 20px;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 10;
    }

    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: calc(100vh - 80px);
      width: 100%;
    }

    .results-box {
      background-color: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(5px);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      width: 90%;
      max-width: 900px;
      margin: 20px 0;
    }

    .results-box h1 {
      color: #006666;
      margin-bottom: 20px;
      text-align: center;
    }

    .status-banner {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: bold;
      font-size: 14px;
    }

    .status-banner.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .trip-details {
      background: rgba(0, 102, 102, 0.1);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 25px;
      border-left: 4px solid #006666;
    }

    .trip-details h3 {
      color: #006666;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .trip-details p {
      margin: 6px 0;
      color: #333;
      font-size: 14px;
    }

    .suggestions-container {
      display: flex;
      gap: 20px;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .suggestion-column {
      background-color: #f9f9f9;
      border-radius: 8px;
      padding: 15px;
      flex: 1;
      min-width: 200px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .suggestion-column h2 {
      font-size: 16px;
      margin-bottom: 10px;
      color: #006666;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
      text-align: center;
    }

    .suggestion-column ul {
      list-style: disc;
      padding-left: 20px;
      color: #333;
      font-size: 14px;
    }

    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 25px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .button-group button {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      color: white;
    }

    .btn-back {
      background: #6c757d;
    }

    .btn-back:hover {
      background: #5a6268;
      transform: translateY(-2px);
    }

    .btn-new {
      background: #006666;
    }

    .btn-new:hover {
      background: #004d4d;
      transform: translateY(-2px);
    }

    .error-message {
      color: #721c24;
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
  </style>
</head>
<body>
  <header class="header-bar">
    ‚úàÔ∏è PlanVise
  </header>

  <main>
    <div class="results-box">
      <h1>üåç Your Trip Suggestions</h1>
      
      <div id="status-banner"></div>
      
      <div class="trip-details" id="trip-info">
        <h3>Trip Details</h3>
        <p id="trip-details-content">Loading trip details...</p>
      </div>
      
      <div class="suggestions-container" id="results"></div>
      
      <div class="button-group">
        <button class="btn-back" onclick="window.history.back()">
          <i class="fas fa-arrow-left"></i> Back to Form
        </button>
        <button class="btn-new" onclick="window.location.href='book.html'">
          <i class="fas fa-plus"></i> Plan New Trip
        </button>
      </div>
    </div>
  </main>

  <script>
    try {
      const storedData = sessionStorage.getItem("ai_result");
      if (!storedData) {
        document.getElementById("results").innerHTML = 
          '<div class="error-message">No results found. Please submit the booking form first.</div>';
        document.getElementById("trip-info").style.display = "none";
        document.getElementById("status-banner").style.display = "none";
      } else {
        const resultData = JSON.parse(storedData);

        // Status banner
        const statusBanner = document.getElementById("status-banner");
        if (resultData.apiSuccess) {
          statusBanner.className = "status-banner success";
          statusBanner.innerHTML = '<i class="fas fa-check-circle"></i> AI-Generated Recommendations';
          statusBanner.style.display = 'block';
        } else {
          statusBanner.style.display = 'none';
        }

        // Trip details
        const details = resultData.tripDetails;
        document.getElementById("trip-details-content").innerHTML = `
          <p><strong>From:</strong> ${details.from}</p>
          <p><strong>To:</strong> ${details.to}</p>
          <p><strong>Start Date:</strong> ${details.start}</p>
          <p><strong>Duration:</strong> ${details.days} days</p>
          <p><strong>Travelers:</strong> ${details.people} people</p>
          <p><strong>Activity Type:</strong> ${details.type}</p>
        `;

        // Split AI text into sections
        const container = document.getElementById("results");
        const aiText = resultData.aiText.replace(/\r\n/g, "\n").trim();
        const sections = aiText.split(/\n\s*\n/);

        sections.forEach(section => {
          const lines = section.trim().split("\n");
          if (lines.length > 1) {
            const title = lines[0].replace(":", "");
            const items = lines.slice(1).map(line => line.replace(/^\d+\.\s*/, "").trim());

            const col = document.createElement("div");
            col.className = "suggestion-column";

            const h2 = document.createElement("h2");
            h2.textContent = title;
            col.appendChild(h2);

            const ul = document.createElement("ul");
            items.forEach(item => {
              if(item) {
                const li = document.createElement("li");
                li.textContent = item;
                ul.appendChild(li);
              }
            });

            col.appendChild(ul);
            container.appendChild(col);
          }
        });
      }
    } catch (error) {
      console.error("Error loading results:", error);
      document.getElementById("results").innerHTML = 
        '<div class="error-message">Error loading results. Please try again.</div>';
      document.getElementById("trip-info").style.display = "none";
      document.getElementById("status-banner").style.display = "none";
    }
  </script>
</body>
</html>
